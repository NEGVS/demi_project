<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.demo.code.mapper.DemoMerchantsMapper">
    <!--resultMap 字段映射结果-->
    <resultMap id="BaseResultMap" type="com.project.demo.code.domain.DemoMerchants">
        <id property="merchantId" column="merchant_id"/>
        <result property="merchantName" column="merchant_name"/>
        <result property="contactName" column="contact_name"/>
        <result property="contactPhone" column="contact_phone"/>
        <result property="email" column="email"/>
        <result property="address" column="address"/>
        <result property="businessLicense" column="business_license"/>
        <result property="userId" column="user_id"/>
        <result property="status" column="status"/>
        <result property="deleted" column="deleted"/>
        <result property="version" column="version"/>
        <result property="createDate" column="create_date"/>
        <result property="createBy" column="create_by"/>
        <result property="updateDate" column="update_date"/>
        <result property="updateBy" column="update_by"/>
    </resultMap>
    <!--Sql字段-->
    <sql id="Base_Column_List">
         merchant_name, contact_name, contact_phone, email, address, business_license, user_id, `status`, deleted,
        version, create_date, create_by, update_date, update_by
    </sql>


    <!--分页查询-->
    <select id="page" resultType="com.project.demo.code.domain.DemoMerchants">
        select merchant_id ,
        <include refid="Base_Column_List"/>
        from demo_merchants
        where deleted = 1
        <if test="command.merchantName != null and command.merchantName != ''">
            and merchant_name like concat('%',#{command.merchantName},'%')
        </if>
        <if test="command.contactName != null and command.contactName != ''">
            and contact_name = #{command.contactName}
        </if>
        <if test="command.contactPhone != null and command.contactPhone != ''">
            and contact_phone = #{command.contactPhone}
        </if>
        <if test="command.email != null and command.email != ''">
            and email = #{command.email}
        </if>
        <if test="command.address != null and command.address != ''">
            and address like concat('%',#{command.address},'%')
        </if>
        <if test="command.status != null">
            and status = #{command.status}
        </if>
        <if test="command.userId != null">
            and user_id = #{command.userId}
        </if>
    </select>
    <!--根据ID查询商家信息 (业务验证用，查询字段 ，商家ID 、 版本 、商家所有者、状态)-->
    <select id="getMerchantsById" resultType="com.project.demo.code.domain.DemoMerchants">
        select merchant_id, version, user_id, `status`
        from demo_merchants
        where deleted = 1
          and merchant_id = #{merchantId}
    </select>
    <!--获取商家信息-->
    <select id="selectMerchantsById" resultType="com.project.demo.code.dto.demo.MerchantsDTO">
        select merchant_id,
               merchant_name,
               contact_name,
               contact_phone,
               email,
               address,
               business_license,
               user_id,
               `status`,
               create_date,
               create_by,
               update_date,
               update_by
        from demo_merchants
        where merchant_id = #{merchantId}
          and deleted = 1
    </select>

    <!--更新商家信息-->
    <update id="updateMerchantsById">
        update demo_merchants
        <set>
            <if test="command.merchantName != null and command.merchantName != ''">
                merchant_name = #{command.merchantName},
            </if>
            <if test="command.contactName != null and command.contactName != ''">
                contact_name = #{command.contactName},
            </if>
            <if test="command.contactPhone != null and command.contactPhone != ''">
                contact_phone = #{command.contactPhone},
            </if>
            <if test="command.email != null and command.email != ''">
                email = #{command.email},
            </if>
            <if test="command.address != null and command.address != ''">
                address = #{command.address},
            </if>
            <if test="command.businessLicense != null and command.businessLicense != ''">
                business_license = #{command.businessLicense},
            </if>
            <if test="command.status != null">
                `status` = #{command.status},
            </if>
        </set>
        where merchant_id = #{command.merchantId} and deleted = 1 and version = #{command.version}
    </update>
</mapper>
