<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†è§ï¼ğŸ†Â·æˆ‘ç™½çš„å‘†å‘†</title>
    <meta name="description" content="ç‰¹åˆ«çºªå¿µé¡µé¢ - æˆ‘ç™½çš„å‘†å‘†">
    <!-- å¾®ä¿¡åˆ†äº«å…ƒæ•°æ® -->
    <meta property="og:title" content="å†è§ï¼ğŸ†Â·æˆ‘ç™½çš„å‘†å‘†" />
    <meta property="og:description" content="ç‚¹å‡»æŸ¥çœ‹å®Œæ•´å†…å®¹ï¼Œè§è¯ç‰¹åˆ«æ—¶åˆ»" />
    <meta property="og:image" content="https://yourdomain.com/static/vx_thumbnail.jpg" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://yourdomain.com/share-page" />
    <!-- å¾®ä¿¡JS-SDK -->
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
</head>
<body>
<script>
    // é…ç½®å¾®ä¿¡åˆ†äº«
    async function initWechatShare() {
        try {
            // è·å–å½“å‰é¡µé¢URLï¼ˆå»é™¤hashéƒ¨åˆ†ï¼‰
            const currentUrl = window.location.href.split('#')[0];

            // ä»åç«¯è·å–ç­¾å
            const response = await fetch(`/api/wechat/signature?url=${encodeURIComponent(currentUrl)}`);
            const { appId, timestamp, nonceStr, signature } = await response.json();

            // åˆå§‹åŒ–é…ç½®
            wx.config({
                debug: false, // ç”Ÿäº§ç¯å¢ƒå…³é—­è°ƒè¯•
                appId,
                timestamp,
                nonceStr,
                signature,
                jsApiList: [
                    'updateAppMessageShareData',
                    'updateTimelineShareData',
                    'onMenuShareAppMessage',
                    'onMenuShareTimeline'
                ]
            });

            // å°±ç»ªå›è°ƒ
            wx.ready(() => {
                // æœ‹å‹åˆ†äº«é…ç½®
                wx.updateAppMessageShareData({
                    title: 'ç‰¹åˆ«çºªå¿µ ğŸ†', // åˆ†äº«æ ‡é¢˜
                    desc: 'ç‚¹å‡»æŸ¥çœ‹å®Œæ•´æ•…äº‹ â†’', // åˆ†äº«æè¿°
                    link: 'https://yourdomain.com/share-page', // åˆ†äº«é“¾æ¥
                    imgUrl: 'https://yourdomain.com/static/vx_thumbnail.jpg', // ç¼©ç•¥å›¾
                    success: () => console.log('AppMessage åˆ†äº«é…ç½®æˆåŠŸ'),
                });

                // æœ‹å‹åœˆåˆ†äº«é…ç½®
                wx.updateTimelineShareData({
                    title: 'ã€ç‰¹åˆ«çºªå¿µã€‘æˆ‘ç™½çš„å‘†å‘†', // æœ‹å‹åœˆé»˜è®¤è¯»å–æ ‡é¢˜
                    link: 'https://yourdomain.com/share-page',
                    imgUrl: 'https://yourdomain.com/static/vx_thumbnail.jpg',
                    success: () => console.log('Timeline åˆ†äº«é…ç½®æˆåŠŸ'),
                });
            });

            // é”™è¯¯å¤„ç†
            wx.error(err => {
                console.error('å¾®ä¿¡SDKé”™è¯¯:', err);
                alert('åˆ†äº«åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
            });

        } catch (error) {
            console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            alert('ç½‘ç»œè¯·æ±‚å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥è¿æ¥');
        }
    }

    // é¡µé¢åŠ è½½åæ‰§è¡Œ
    window.addEventListener('load', initWechatShare);
</script>
</body>
</html>
