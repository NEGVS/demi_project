<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鸡汤文案管理</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #e0eafc, #cfdef3); /* 渐变背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            width: 80%;
            max-width: 900px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background-color: #34495e;
            color: #fff;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f9f9f9; /* 鼠标悬停效果 */
        }
        button {
            padding: 6px 12px;
            margin-right: 8px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .edit-btn {
            background-color: #3498db;
            color: #fff;
        }
        .edit-btn:hover {
            background-color: #2980b9;
        }
        .delete-btn {
            background-color: #e74c3c;
            color: #fff;
        }
        .delete-btn:hover {
            background-color: #c0392b;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .pagination {
            margin-top: 20px;
            text-align: center;
        }
        .pagination button {
            padding: 8px 16px;
            background-color: #3498db;
            color: #fff;
            margin: 0 5px;
        }
        .pagination button:disabled {
            background-color: #bdc3c7;
        }
        .pagination span {
            font-size: 16px;
            color: #333;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>鸡汤文案管理</h1>
    <table id="chickenSoupTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Content</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <!-- 动态生成表格行 -->
        </tbody>
    </table>
    <div class="pagination">
        <button onclick="chickenSoupPrevPage()">上一页</button>
        <span id="pageInfo"></span>
        <button onclick="chickenSoupNextPage()">下一页</button>
    </div>
</div>
<script>
    let current = 1; // 当前页码
    const pageSize = 5;  // 每页显示条数
    let pages = 1;  // 总页数（从后端获取）

    // 获取分页数据并渲染
    function chickenSoupFetchData(page) {
        fetch('/chickenSoup/queryAll', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id: null,
                content: null,
                pageNum: page || current,
                pageSize: pageSize
            })
        })
            .then(response => response.json())
            .then(data => {
                renderTable(data.data.records); // 渲染表格数据
                pages = Math.ceil(data.data.total / pageSize); // 计算总页数
                updatePagination(); // 更新分页信息
            })
            .catch(error => {
                console.error('获取数据失败:', error);
                alert('无法加载鸡汤文案');
            });
    }

    // 渲染表格
    function renderTable(data) {
        const tbody = document.querySelector('#chickenSoupTable tbody');
        tbody.innerHTML = '';
        data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.id}</td>
                <td>${item.content}</td>
                <td>
                    <button class="edit-btn" onclick="chickenSoupEdit(${item.id}, this)">编辑</button>
                    <button class="delete-btn" onclick="chickenSoupDelete(${item.id}, this)">删除</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // 更新分页信息
    function updatePagination() {
        const pageInfo = document.getElementById('pageInfo');
        pageInfo.textContent = `第 ${current} 页 / 共 ${pages} 页`;
        document.querySelector('.pagination button:first-child').disabled = current === 1;
        document.querySelector('.pagination button:last-child').disabled = current === pages;
    }

    // 上一页
    function chickenSoupPrevPage() {
        if (current > 1) {
            current--;
            chickenSoupFetchData();
        }
    }

    // 下一页
    function chickenSoupNextPage() {
        if (current < pages) {
            current++;
            chickenSoupFetchData();
        }
    }

    // 编辑功能
    function chickenSoupEdit(id, button) {
        const row = button.closest('tr');
        const currentContent = row.cells[1].textContent;
        const newContent = prompt('编辑文案:', currentContent);
        if (newContent !== null && newContent !== currentContent) {
            button.disabled = true;
            fetch('/chickenSoup/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: id, content: newContent })
            })
                .then(response => {
                    if (!response.ok) throw new Error('更新失败');
                    return response.json();
                })
                .then(() => {
                    chickenSoupFetchData(); // 刷新表格
                })
                .catch(error => {
                    console.error('编辑失败:', error);
                    alert('编辑文案失败');
                })
                .finally(() => {
                    button.disabled = false;
                });
        }
    }

    // 删除功能
    function chickenSoupDelete(id, button) {
        if (confirm('确定要删除这条文案吗？')) {
            button.disabled = true;
            fetch(`/chickenSoup/delete/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (!response.ok) throw new Error('删除失败');
                    return response.json();
                })
                .then(() => {
                    chickenSoupFetchData(); // 刷新表格
                })
                .catch(error => {
                    console.error('删除失败:', error);
                    alert('删除文案失败');
                })
                .finally(() => {
                    button.disabled = false;
                });
        }
    }

    // 页面加载时获取第一页数据
    window.onload = () => chickenSoupFetchData(1);
</script>
</body>
</html>